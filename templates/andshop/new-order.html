<!DOCTYPE html>
<html lang="en" dir="ltr">
<!-- Mirrored from andit.co/projects/html/andshop/andshop-dashboard/new-order.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 25 Feb 2023 08:14:42 GMT -->
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="description" content="Andshop - Admin Dashboard HTML Template.">

	<title>Andshop</title>

	<!-- GOOGLE FONTS -->
	<link rel="preconnect" href="https://fonts.googleapis.com/">
	<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800&amp;family=Poppins:wght@300;400;500;600;700;800;900&amp;family=Roboto:wght@400;500;700;900&amp;display=swap"
		rel="stylesheet">

	<link href="{{ url_for('static', filename='assets/css/materialdesignicons.min.css') }}" rel="stylesheet" />

	<!-- PLUGINS CSS STYLE -->
	<link href="{{ url_for('static', filename='assets/plugins/simplebar/simplebar.css') }}" rel="stylesheet" />

	<!-- Data-Tables -->
	<link href="{{ url_for('static', filename='assets/plugins/data-tables/datatables.bootstrap5.min.css') }}" rel='stylesheet'>
	<link href="{{ url_for('static', filename='assets/plugins/data-tables/responsive.datatables.min.css') }}" rel='stylesheet'>

	<!-- custom css -->
	<link id="style.css" rel="stylesheet" href="{{ url_for('static', filename='assets/css/style.css') }}" />

	<!-- FAVICON -->
	<link href="{{ url_for('static', filename='assets/img/favicon.png') }}" rel="shortcut icon" />

	<!-- Custom styles for download button -->
	<style>
		.ec-breadcrumb-action .btn-primary {
			background-color: #4e73df;
			border-color: #4e73df;
			color: white;
			padding: 8px 16px;
			border-radius: 5px;
			font-weight: 500;
			text-decoration: none;
			display: inline-flex;
			align-items: center;
			transition: all 0.2s ease;
		}
		
		.ec-breadcrumb-action .btn-primary:hover {
			background-color: #375ad3;
			border-color: #375ad3;
			transform: translateY(-1px);
			box-shadow: 0 2px 5px rgba(0,0,0,0.1);
		}
		
		.ec-breadcrumb-action .btn-primary i {
			font-size: 18px;
			margin-right: 6px;
		}
		
		.breadcrumb-wrapper {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 20px;
		}
	</style>

	<!-- PDF Generation Libraries -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

	<script type="text/javascript">
		window.addEventListener('pageshow', function(event) {
			if (event.persisted) {
				// If the page is loaded from the cache, reload it
				window.location.reload();
			}
		});
	</script>
	
</head>

<body class="ec-header-fixed ec-sidebar-fixed ec-sidebar-dark ec-header-light" id="body">

	<!-- WRAPPER -->
	<div class="wrapper">

		<!-- LEFT MAIN SIDEBAR -->
		<div class="ec-left-sidebar ec-bg-sidebar">
			<div id="sidebar" class="sidebar ec-sidebar-footer">

				<div class="ec-brand">
					<a href="/vendor_dashboard">
						<img class="ec-brand-icon" src="assets/img/logo/favicon.png" alt="" />
						<span class="ec-brand-name text-truncate">ANDSHOP</span>
					</a>
				</div>
				<!-- begin sidebar scrollbar -->
				<div class="ec-navigation" data-simplebar>
					<!-- sidebar menu -->
					<ul class="nav sidebar-inner" id="sidebar-menu">
						<!-- Dashboard -->
						<li class="active">
							<a class="sidenav-item-link" href="/vendor_dashboard">
								<i class="mdi mdi-view-dashboard-outline"></i>
								<span class="nav-text">Dashboard</span>
							</a>
							<hr>
						</li>
						<!-- Users -->
						<li class="has-sub">
							<a class="sidenav-item-link" href="javascript:void(0)">
								<i class="mdi mdi-account-multiple-outline"></i>
								<span class="nav-text">Customers</span> <b class="caret"></b>
							</a>
							<div class="collapse">
								<ul class="sub-menu" id="users" data-parent="#sidebar-menu">

									<li class="">
										<a class="sidenav-item-link" href='/user-list'>
											<span class="nav-text">User List</span>
										</a>
									</li>
								</ul>
							</div>
							<hr>
						</li>
						<!-- Analytics -->
						<li class="has-sub">
							<a class="sidenav-item-link" href="javascript:void(0)">
								<i class="mdi mdi-chart-line"></i>
								<span class="nav-text">Analytics</span> <b class="caret"></b>
							</a>
							<div class="collapse">
								<ul class="sub-menu" id="analytics" data-parent="#sidebar-menu">
									<li class="">
										<a class="sidenav-item-link" href="/store-revenue">
											<span class="nav-text">Store Revenue</span>
										</a>
									</li>
								</ul>
							</div>
							<hr>
						</li>
						<!-- Products -->
						<li class="has-sub">
							<a class="sidenav-item-link" href="javascript:void(0)">
								<!-- <i class="mdi mdi-palette-advanced"></i> -->
								<i class="mdi mdi-package-variant-closed"></i>
								<span class="nav-text">Products</span> <b class="caret"></b>
							</a>
							<div class="collapse">
								<ul class="sub-menu" id="products" data-parent="#sidebar-menu">
									<li class="">
										<a class="sidenav-item-link" href="/product-add">
											<span class="nav-text">Add Product</span>
										</a>										
									</li>
									<li class="">
										<a class="sidenav-item-link" href="/products">
											<span class="nav-text">List Product</span>
										</a>
									</li>
								</ul>
							</div>
						</li>

						<!-- Orders -->
						<li class="has-sub">
							<a class="sidenav-item-link" href="javascript:void(0)">
								<i class="mdi mdi-cart-outline"></i>
								<span class="nav-text">Orders</span> <b class="caret"></b>
							</a>
							<div class="collapse">
								<ul class="sub-menu" id="orders" data-parent="#sidebar-menu">
									<li class="">
										<a class="sidenav-item-link" href="/new-order">
											<span class="nav-text">Order list</span>
										</a>
									</li>
								</ul>
							</div>
						</li>
						<!-- Error page -->
						<li>
							<a class="sidenav-item-link" href="/analysis">
								<i class="mdi mdi-finance"></i>
								<span class="nav-text">Product Analysis page</span>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!-- PAGE WRAPPER -->
		<div class="ec-page-wrapper">

			<!-- Header -->
			<header class="ec-main-header" id="header">
				<nav class="navbar navbar-static-top navbar-expand-lg">
					<!-- Sidebar toggle button -->
					<button id="sidebar-toggler">
						<img src="{{ url_for('static', filename='assets/img/icons/clops.png') }}" alt="">
					</button>
					<!-- search form -->
					<div class="search-form d-lg-inline-block">
						<div class="input-group">
							<input type="text" name="query" id="search-input" class="form-control"
								placeholder="search.." autofocus autocomplete="off" />
							<button type="button" name="search" id="search-btn" class="btn btn-flat">
								<i class="mdi mdi-magnify"></i>
							</button>
						</div>
						<div id="search-results-container">
							<ul id="search-results"></ul>
						</div>
					</div>

					<!-- navbar right -->
					<div class="navbar-right">
						<ul class="nav navbar-nav">
							<!-- User Account -->
							<li class="dropdown user-menu">
								<button class="dropdown-toggle nav-link ec-drop" data-bs-toggle="dropdown"
									aria-expanded="false">
									<img src="static/{{ user_info.profile_pic}}" class="user-image" alt="User Image" />
								</button>
								<ul class="dropdown-menu dropdown-menu-right ec-dropdown-menu">
									<!-- User image -->
									<li class="dropdown-header">
										<div class="d-inline-block">
											<h5>{{ user_info.name }}</h5>
											<p class="pt-2">{{ user_info.email }}</p>
										</div>
									</li>
									<li>
										<a href='/user-profile'>
											<i class="mdi mdi-account"></i> My Profile
										</a>
									</li>
									<li class="dropdown-footer">
										<a href="/logout"> <i class="mdi mdi-logout"></i> Log Out </a>
									</li>
								</ul>
							</li>
							
						</ul>
					</div>
				</nav>
			</header>

			<!-- CONTENT WRAPPER -->
			<div class="ec-content-wrapper">
				<div class="content">
					<div class="breadcrumb-wrapper">
						<div>
							<h1>All Orders</h1>
							<p class="breadcrumbs"><span><a href="/vendor_dashboard">Home</a></span>
								<span><i class="mdi mdi-chevron-right"></i></span>All Orders
							</p>
						</div>
						<div class="ec-breadcrumb-action">
							<a href="#" class="btn btn-primary" id="downloadOrdersReport">
								<i class="mdi mdi-download me-1"></i> Download Orders Report
							</a>
						</div>
					</div>
					<div class="row">
						<div class="col-12">
							<div class="card card-default">
								<div class="card-body">
									<div class="table-responsive">
										<table id="responsive-data-table" class="table" style="width:100%">
											<thead>
												<tr>
													<th>Photo</th>
													<th>Product name</th>
													<th>Category</th>
													<th>Price</th>
													<th>Rented From</th>
													<th>Rented To</th>
													<th>Status</th>
													<th>Shipping address</th>
													<th>Quantity</th>
												</tr>
											</thead>

											<tbody>
												{% if orders %}
												{% for order in orders %}
												{% if order.store_name == user_info.store_name %}
												{% set product = products.get(order.product_id, {}) %}
												<tr>
													<td><img class="product-img tbl-img"
															src="{{ product.get('product_image', '') }}" alt="product"></td>
													<td>{{ product.get('product_name', 'Unknown Product') }}</td>
													<td>{{ product.get('main_category', 'N/A') }}</td>
													<td>₹{{ order.total_price }}</td>
													<td>{{ order.rent_from }}</td>
													<td>{{ order.rent_to }}</td>
													<td>
														<span class="badge {% if order.get('status', '') == 'ordered' %}badge-warning
																		{% elif order.get('status', '') == 'confirmed' %}badge-success
																		{% elif order.get('status', '') == 'cancelled' %}badge-danger
																		{% elif order.get('status', '') == 'completed' %}badge-info
																		{% elif order.get('status', '') == 'delivered' %}badge-primary
																		{% else %}badge-secondary{% endif %}">
															{{ order.get('status', 'Unknown')|title }}
														</span>
													</td>
													<td>{{ order.shipping_address }}{% if order.shipping_district %}, {{ order.shipping_district }}{% endif %}</td>
													<td>{{ order.quantity }}</td>
												</tr>
												{% endif %}
												{% endfor %}
												{% else %}
												<tr>
													<td colspan="10" class="text-center">No orders found for this store.</td>
												</tr>
												{% endif %}
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div> <!-- End Content -->
			</div> <!-- End Content Wrapper -->

			<!-- Footer -->
			<footer class="footer mt-auto">
				<div class="copyright bg-white">
					<p>
						Copyright © 2023. All right reserved.
					</p>
				</div>
			</footer>

		</div> <!-- End Page Wrapper -->
	</div> <!-- End Wrapper -->

	<!-- Common Javascript -->
	<script src="{{ url_for('static', filename='assets/plugins/jquery/jquery-3.5.1.min.js') }}"></script>
	<script src="{{ url_for('static', filename='assets/js/bootstrap.bundle.min.js') }}"></script>
	<script src="{{ url_for('static', filename='assets/plugins/simplebar/simplebar.min.js') }}"></script>
	<script src="{{ url_for('static', filename='assets/plugins/jquery-zoom/jquery.zoom.min.js') }}"></script>
	<script src="{{ url_for('static', filename='assets/plugins/slick/slick.min.js') }}"></script>

	<!-- Data-Tables -->
	<script src="{{ url_for('static', filename='assets/plugins/data-tables/jquery.datatables.min.js') }}"></script>
	<script src="{{ url_for('static', filename='assets/plugins/data-tables/datatables.bootstrap5.min.js') }}"></script>
	<script src="{{ url_for('static', filename='assets/plugins/data-tables/datatables.responsive.min.js') }}"></script>

	<!-- Option Switcher -->
	<script src="{{ url_for('static', filename='assets/plugins/options-sidebar/optionswitcher.js') }}"></script>

	<!-- custom js -->
	<script src="{{ url_for('static', filename='assets/js/custom.js') }}"></script>

	<!-- Add this script for cancel order functionality -->
	<script>
	$(document).ready(function() {
		function showAlert(message) {
			$('#alertModalBody').text(message);
			$('#alertModal').modal('show');
		}

		$('.cancel-order-btn').on('click', function() {
			var orderId = $(this).data('order-id');
			if (confirm('Are you sure you want to cancel this order?')) {
				$.ajax({
					url: '/cancel-order',
					method: 'POST',
					data: JSON.stringify({ order_id: orderId }),
					contentType: 'application/json',
					success: function(response) {
						if (response.success) {
							showAlert('Order cancelled successfully');
							location.reload();  // Reload the page to reflect the changes
						} else {
							showAlert('Failed to cancel order: ' + response.message);
						}
					},
					error: function() {
						showAlert('An error occurred while trying to cancel the order');
					}
				});
			}
		});
	});
	</script>

	<!-- Add this just before the closing </body> tag -->
	<div class="modal fade" id="alertModal" tabindex="-1" role="dialog" aria-labelledby="alertModalLabel" aria-hidden="true">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="alertModalLabel">Alert</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body" id="alertModalBody">
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
	      </div>
	    </div>
	  </div>
	</div>

	<!-- Confirmation Modal -->
	<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="confirmModalLabel">Confirm Order Cancellation</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        Are you sure you want to cancel this order?
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
	        <button type="button" class="btn btn-danger" id="confirmCancelBtn">Yes, Cancel Order</button>
	      </div>
	    </div>
	  </div>
	</div>

	<!-- PDF Report Generation Scripts -->
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			// Initialize jsPDF
			const { jsPDF } = window.jspdf;
			
			// Download Orders Report
			document.getElementById('downloadOrdersReport').addEventListener('click', function() {
				// Create new PDF document
				const doc = new jsPDF();
				const vendorName = "{{ user_info.name }}";
				const currentDate = new Date().toLocaleDateString();
				
				// Add title and header
				doc.setFontSize(20);
				doc.text('Orders Report', 105, 15, { align: 'center' });
				
				doc.setFontSize(12);
				doc.text(`Vendor: ${vendorName}`, 14, 25);
				doc.text(`Generated: ${currentDate}`, 14, 32);
				
				// Extract order data
				const orders = [];
				{% for order in orders %}
				{% if order.store_name == user_info.store_name %}
				{% set product = products.get(order.product_id, {}) %}
				orders.push([
					'{{ product.get("product_name", "Unknown Product") }}',
					'{{ product.get("main_category", "N/A") }}',
					`Rs ${parseFloat({{ order.total_price|default(0) }}).toFixed(2)}`,
					'{{ order.rent_from }}',
					'{{ order.rent_to }}',
					'{{ order.get("status", "Unknown")|title }}',
					{{ order.quantity|default(0) }}
				]);
				{% endif %}
				{% endfor %}
				
				// Create table with order data
				doc.autoTable({
					head: [['Product Name', 'Category', 'Price (Rs)', 'Rented From', 'Rented To', 'Status', 'Quantity']],
					body: orders,
					startY: 40,
					theme: 'grid',
					styles: { fontSize: 10, cellPadding: 3 },
					headStyles: { fillColor: [66, 139, 202] }
				});
				
				// Order summary
				const totalOrders = orders.length;
				
				const finalY = doc.lastAutoTable.finalY + 10;
				doc.setFontSize(12);
				doc.text(`Summary:`, 14, finalY);
				doc.text(`Total Orders: ${totalOrders}`, 14, finalY + 7);
				
				// Calculate total revenue if price data is available
				let totalRevenue = 0;
				{% for order in orders %}
				{% if order.store_name == user_info.store_name %}
				totalRevenue += parseFloat({{ order.total_price|default(0) }});
				{% endif %}
				{% endfor %}
				
				doc.text(`Total Revenue: Rs ${totalRevenue.toFixed(2)}`, 14, finalY + 14);
				
				// Save PDF
				doc.save(`${vendorName.replace(/\s+/g, '_')}_Orders_Report_${currentDate.replace(/\//g, '-')}.pdf`);
			});
		});
	</script>
</body>


<!-- Mirrored from andit.co/projects/html/andshop/andshop-dashboard/new-order.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 25 Feb 2023 08:14:43 GMT -->
</html>
