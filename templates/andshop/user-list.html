<!DOCTYPE html>
<html lang="en" dir="ltr">


<!-- Mirrored from andit.co/projects/html/andshop/andshop-dashboard/user-list.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 25 Feb 2023 08:14:29 GMT -->

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="description" content="Andshop - Admin Dashboard HTML Template.">

	<title>Andshop - Admin Dashboard HTML Template.</title>

	<!-- GOOGLE FONTS -->
	<link rel="preconnect" href="https://fonts.googleapis.com/">
	<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800&amp;family=Poppins:wght@300;400;500;600;700;800;900&amp;family=Roboto:wght@400;500;700;900&amp;display=swap"
		rel="stylesheet">

	<link href="{{ url_for('static', filename='assets/css/materialdesignicons.min.css') }}" rel="stylesheet" />
	<!-- PLUGINS CSS STYLE -->
	<link href="{{ url_for('static', filename='assets/plugins/daterangepicker/daterangepicker.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='assets/plugins/simplebar/simplebar.css') }}" rel="stylesheet">

	<!-- Data Tables -->
	<link href="{{ url_for('static', filename='assets/plugins/data-tables/datatables.bootstrap5.min.css') }}" rel="stylesheet">
	<link href="{{ url_for('static', filename='assets/plugins/data-tables/responsive.datatables.min.css') }}" rel="stylesheet">	

	<!-- custom css -->
	<link id="style.css" rel="stylesheet" href="{{ url_for('static', filename='assets/css/style.css') }}" />

	<!-- FAVICON -->
	<link href="{{ url_for('static', filename='assets/img/favicon.png') }}" rel="shortcut icon" />
	<script type="text/javascript">
		window.addEventListener('pageshow', function(event) {
			if (event.persisted) {
				// If the page is loaded from the cache, reload it
				window.location.reload();
			}
		});
	</script>
	
</head>

<body class="ec-header-fixed ec-sidebar-fixed ec-sidebar-dark ec-header-light" id="body">

	<!-- WRAPPER -->
	<div class="wrapper">

		<!-- LEFT MAIN SIDEBAR -->
		<div class="ec-left-sidebar ec-bg-sidebar">
			<div id="sidebar" class="sidebar ec-sidebar-footer">

				<div class="ec-brand">
					<a href="/vendor_dashboard">
						<img class="ec-brand-icon" src="assets/img/logo/favicon.png" alt="" />
						<span class="ec-brand-name text-truncate">ANDSHOP</span>
					</a>
				</div>
				<!-- begin sidebar scrollbar -->
				<div class="ec-navigation" data-simplebar>
					<!-- sidebar menu -->
					<ul class="nav sidebar-inner" id="sidebar-menu">
						<!-- Dashboard -->
						<li class="active">
							<a class="sidenav-item-link" href="/vendor_dashboard">
								<i class="mdi mdi-view-dashboard-outline"></i>
								<span class="nav-text">Dashboard</span>
							</a>
							<hr>
						</li>
						<!-- Users -->
						<li class="has-sub">
							<a class="sidenav-item-link" href="javascript:void(0)">
								<i class="mdi mdi-account-multiple-outline"></i>
								<span class="nav-text">Customers</span> <b class="caret"></b>
							</a>
							<div class="collapse">
								<ul class="sub-menu" id="users" data-parent="#sidebar-menu">

									<li class="">
										<a class="sidenav-item-link" href='/user-list'>
											<span class="nav-text">User List</span>
										</a>
									</li>
								</ul>
							</div>
							<hr>
						</li>
						<!-- Analytics -->
						<li class="has-sub">
							<a class="sidenav-item-link" href="javascript:void(0)">
								<i class="mdi mdi-chart-line"></i>
								<span class="nav-text">Analytics</span> <b class="caret"></b>
							</a>
							<div class="collapse">
								<ul class="sub-menu" id="analytics" data-parent="#sidebar-menu">
									<li class="">
										<a class="sidenav-item-link" href="/store-revenue">
											<span class="nav-text">Store Revenue</span>
										</a>
									</li>
								</ul>
							</div>
							<hr>
						</li>
						<!-- Products -->
						<li class="has-sub">
							<a class="sidenav-item-link" href="javascript:void(0)">
								<i class="mdi mdi-package-variant-closed"></i>
								<span class="nav-text">Products</span> <b class="caret"></b>
							</a>
							<div class="collapse">
								<ul class="sub-menu" id="products" data-parent="#sidebar-menu">
									<li class="">
										<a class="sidenav-item-link" href="/product-add">
											<span class="nav-text">Add Product</span>
										</a>
									</li>
									<li class="">
										<a class="sidenav-item-link" href="/products">
											<span class="nav-text">List Product</span>
										</a>
									</li>
									<li class="">
										<a class="sidenav-item-link" href="/lost-products">
											<span class="nav-text">Lost Products</span>
										</a>
									</li>
								</ul>
							</div>
						</li>

						<!-- Orders -->
						<li class="has-sub">
							<a class="sidenav-item-link" href="javascript:void(0)">
								<i class="mdi mdi-cart-outline"></i>
								<span class="nav-text">Orders</span> <b class="caret"></b>
							</a>
							<div class="collapse">
								<ul class="sub-menu" id="orders" data-parent="#sidebar-menu">
									<li class="">
										<a class="sidenav-item-link" href="/new-order">
											<span class="nav-text">Order list</span>
										</a>
									</li>
								</ul>
							</div>
						</li>
						<!-- Error page -->
						<li>
							<a class="sidenav-item-link" href="/analysis">
								<i class="mdi mdi-finance"></i>
								<span class="nav-text">Product Analysis page</span>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>

		<!-- PAGE WRAPPER -->
		<div class="ec-page-wrapper">

			<!-- Header -->
			<header class="ec-main-header" id="header">
				<nav class="navbar navbar-static-top navbar-expand-lg">
					<!-- Sidebar toggle button -->
					<button id="sidebar-toggler">
						<img src="assets/img/icons/clops.png" alt="">
					</button>
					<!-- search form -->
					<div class="search-form d-lg-inline-block">
						<div class="input-group">
							<input type="text" name="query" id="search-input" class="form-control"
								placeholder="search.." autofocus autocomplete="off" />
							<button type="button" name="search" id="search-btn" class="btn btn-flat">
								<i class="mdi mdi-magnify"></i>
							</button>
						</div>
						<div id="search-results-container">
							<ul id="search-results"></ul>
						</div>
					</div>

					<!-- navbar right -->
					<div class="navbar-right">
						<ul class="nav navbar-nav">
							<!-- User Account -->
							<li class="dropdown user-menu">
								<button class="dropdown-toggle nav-link ec-drop" data-bs-toggle="dropdown"
									aria-expanded="false">
									<img src="static/{{ user.profile_pic }}" class="user-image" alt="User Image" />
								</button>
								<ul class="dropdown-menu dropdown-menu-right ec-dropdown-menu">
									<!-- User image -->
									<li class="dropdown-header">
										<div class="d-inline-block">
											<h5> {{ user.name }}</h5>
											<p class="pt-2">{{ user.email}}</p>
										</div>
									</li>
									<li>
										<a href="{{ url_for('user_profile') }}">
											<i class="mdi mdi-account"></i> My Profile
										</a>
									</li>
									
									<li class="dropdown-footer">
										<a href="/logout"> <i class="mdi mdi-logout"></i> Log Out </a>
									</li>
								</ul>
							</li>
							
						</ul>
					</div>
				</nav>
			</header>

			<!-- CONTENT WRAPPER -->
			<!-- customer list code -->
			<div class="ec-content-wrapper">
				<div class="content">
					<div class="breadcrumb-wrapper breadcrumb-contacts">
						<div>
							<h1>Customer List</h1>
							<p class="breadcrumbs">
								<span><a href="/vendor_dashboard">Home</a></span>
								<span><i class="mdi mdi-chevron-right"></i></span>Customer
							</p>
						</div>
					</div>
					<div class="row">
						<div class="col-xl-12 col-lg-12">
							<div class="ec-cat-list card card-default">
								<div class="card-body">
									<div class="table-responsive">
										<table id="responsive-data-table" class="table">
											<thead>
												<tr>
													<th>Full Name</th>
													<th>Email</th>
													<th>Location</th>
													<th>Status</th>
													<th>Joined</th>
													<th>Action</th>
												</tr>
											</thead>
											<tbody>
												{% if users %}
													{% for user_id, user in users.items() %}
														<tr>
															<td>{{ user.name }}</td>
															<td>{{ user.email }}</td>
															<td>{{ user.district }}</td>
															<td>
																<span class="badge {% if user.status == 'active' %}badge-success{% else %}badge-danger{% endif %}">
																	{{ user.status|capitalize }}
																</span>
															</td>
															<td>{{ user.registration_date }}</td>
															<td>
																<div class="form-check form-switch">
																	<input class="form-check-input toggle-status" type="checkbox" 
																		   id="statusSwitch{{ user_id }}" 
																		   data-user-id="{{ user_id }}" 
																		   {% if user.status == 'active' %}checked{% endif %}>
																	<label class="form-check-label" for="statusSwitch{{ user_id }}">
																		<span class="status-text">{{ user.status|capitalize }}</span>
																	</label>
																</div>
															</td>
														</tr>
													{% endfor %}
												{% else %}
													<tr>
														<td colspan="6">No customer users found.</td>
													</tr>
												{% endif %}
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div> <!-- End Content -->
			</div>
			
			<!-- Footer -->
			<footer class="footer mt-auto">
				<div class="copyright bg-white">
					<p>
						Copyright © 2023. All right reserved.
					</p>
				</div>
			</footer>

		</div> <!-- End Page Wrapper -->
	</div> <!-- End Wrapper -->

<!-- Common Javascript -->
<script src="{{ url_for('static', filename='assets/plugins/jquery/jquery-3.5.1.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/plugins/simplebar/simplebar.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/plugins/jquery-zoom/jquery.zoom.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/plugins/slick/slick.min.js') }}"></script>

<!-- Data Tables -->
<script src="{{ url_for('static', filename='assets/plugins/data-tables/jquery.datatables.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/plugins/data-tables/datatables.bootstrap5.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/plugins/data-tables/datatables.responsive.min.js') }}"></script>
<script src="{{ url_for('static', filename='assets/plugins/options-sidebar/optionswitcher.js') }}"></script>

	<!-- custom js -->
	<script src="{{ url_for('static', filename='assets/js/custom.js') }}"></script>
	<script>
		$(document).ready(function() {
			// Initialize DataTable
			if (!$.fn.DataTable.isDataTable('#responsive-data-table')) {
				$('#responsive-data-table').DataTable({
					responsive: true,
					"aLengthMenu": [
						[10, 25, 50, 75, -1],
						[10, 25, 50, 75, "All"]
					],
					"pageLength": 10
				});
			}
			
			let currentCheckbox = null;
			let currentUserId = null;
			
			// Create a direct reference to the modal DOM element
			const modalElement = document.getElementById('deactivationModal');
			
			// Direct jQuery Modal Usage
			$('.toggle-status').on('change', function() {
				var checkbox = $(this);
				var userId = checkbox.data('user-id');
				var newStatus = checkbox.prop('checked') ? 'active' : 'inactive';

				if (newStatus === 'inactive') {
					currentCheckbox = checkbox;
					currentUserId = userId;
					$('#deactivationModal').modal('show'); // Using jQuery to show modal
					checkbox.prop('checked', true); // Keep the checkbox checked until confirmed
				} else {
					updateUserStatus(userId, newStatus, checkbox);
				}
			});

			$('#confirmDeactivation').on('click', function() {
				var reason = $('#deactivationReason').val().trim();
				if (reason === '') {
					alert('Please provide a reason for deactivation.');
					return;
				}

				updateUserStatus(currentUserId, 'inactive', currentCheckbox, reason);
				$('#deactivationModal').modal('hide'); // Using jQuery to hide modal
			});

			// jQuery way to handle modal hidden event
			$('#deactivationModal').on('hidden.bs.modal', function () {
				if (currentCheckbox) {
					currentCheckbox.prop('checked', true); // Reset checkbox if modal is dismissed
				}
				$('#deactivationReason').val(''); // Clear the textarea
			});

			function updateUserStatus(userId, newStatus, checkbox, reason = '') {
				$.ajax({
					url: '/toggle-user-status/' + userId,
					method: 'POST',
					data: JSON.stringify({
						'status': newStatus,
						'reason': reason
					}),
					contentType: 'application/json',
					success: function(response) {
						console.log('Update user status response:', response);
						if (response.success) {
							updateUIForStatus(userId, response.current_status);
						} else {
							console.error('Error:', response.message);
							checkbox.prop('checked', !checkbox.prop('checked'));
							alert('Failed to update user status: ' + response.message);
						}
					},
					error: function(xhr, status, error) {
						console.error('AJAX Error:', status, error);
						console.error('Response Text:', xhr.responseText);
						checkbox.prop('checked', !checkbox.prop('checked'));
						alert('An error occurred while updating the user status. Please try again.');
					}
				});
			}

			function updateUIForStatus(userId, status) {
				var row = $(`#statusSwitch${userId}`).closest('tr');
				var statusBadge = row.find('.badge');
				var statusLabel = row.find('.form-check-label');
				var checkbox = $(`#statusSwitch${userId}`);

				statusBadge.removeClass('badge-success badge-danger')
						   .addClass(status === 'active' ? 'badge-success' : 'badge-danger')
						   .text(status.charAt(0).toUpperCase() + status.slice(1));

				statusLabel.find('.status-text').text(status.charAt(0).toUpperCase() + status.slice(1));
				checkbox.prop('checked', status === 'active');
			}
		});
	</script>

<!-- Deactivation Reason Modal -->
<div class="modal fade" id="deactivationModal" tabindex="-1" aria-labelledby="deactivationModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deactivationModalLabel">User Deactivation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="deactivationForm">
          <div class="mb-3">
            <label for="deactivationReason" class="form-label">Please enter a reason for deactivation:</label>
            <textarea class="form-control" id="deactivationReason" rows="3" required></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeactivation">Deactivate</button>
      </div>
    </div>
  </div>
</div>

</div>
</body>



<!-- Mirrored from andit.co/projects/html/andshop/andshop-dashboard/user-list.php by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 25 Feb 2023 08:14:29 GMT -->

</html>